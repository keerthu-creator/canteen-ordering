const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const upload = document.getElementById('upload');

upload.addEventListener('change', (e) => {
  const file = e.target.files[0];
  if (!file) return;

  const img = new Image();
  img.onload = () => {
    // Resize canvas to fit notebook width while keeping aspect ratio
    const maxWidth = 550; // max width of notebook area
    const scale = Math.min(maxWidth / img.width, 1);
    canvas.width = img.width * scale;
    canvas.height = img.height * scale;

    // Draw the image scaled
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    // Apply pencil sketch
    applySketch();
  };
  img.src = URL.createObjectURL(file);
});

function applySketch() {
  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
  const data = imageData.data;

  for (let i = 0; i < data.length; i += 4) {
    // Convert to grayscale
    const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
    // Invert for sketch effect
    const sketch = 255 - avg;
    data[i] = data[i + 1] = data[i + 2] = sketch;
  }

  ctx.putImageData(imageData, 0, 0);
}